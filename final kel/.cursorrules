# Cursor Rules for Kelly MIDI Companion Workspace

## Project Overview

This is the **Kelly MIDI Companion** workspace - a therapeutic music generation system that translates emotions into music. The project combines:

- **C++/JUCE Plugin** (`src/`) - Real-time audio plugin for DAWs
- **Python ML Framework** (`ml_framework/`) - CIF/LAS/QEF conscious AI systems
- **Python Reference** (`python/`, `reference/`) - Reference implementations
- **Data Resources** (`data/`) - Emotion mappings, music theory databases

## Philosophy

> *"Interrogate Before Generate"* â€” The tool shouldn't finish art for people; it should make them braver.

Kelly exists because technical perfection is not the same as emotional truth. Sometimes the "wrong" note is exactly right.

## Code Organization

### C++ Code (`src/`)

- Follow JUCE coding standards
- Use C++20 features appropriately
- Core logic: `src/core/`
- Engines: `src/engines/` (14 engines total)
- UI: `src/ui/`
- Plugin: `src/plugin/`

### Python Code

- Follow PEP 8
- Use type hints (`typing` module)
- ML Framework: `ml_framework/cif_las_qef/`
- Reference: `reference/python_kelly/`
- Visualization: `CODE/PYTHON CODE/`

### Data Files (`data/`)

- JSON format
- Emotion files: `data/emotions/`
- Music theory: `data/progressions/`, `data/scales/`
- Grooves: `data/grooves/`

## Key Concepts

### Three-Phase Intent System

1. **Phase 0: Wound** - Identify emotional trigger
2. **Phase 1: Emotion** - Map to 216-node thesaurus (valence, arousal, intensity)
3. **Phase 2: Rule-Breaks** - Intentional music theory violations

### Emotion Thesaurus

- 216-node emotion graph
- 3D space: Valence (-1.0 to +1.0), Arousal (0.0 to 1.0), Intensity (0.0 to 1.0)
- Maps emotions to musical parameters

### ML Framework Components

- **CIF**: Conscious Integration Framework (human-AI bridge)
- **LAS**: Living Art Systems (self-evolving creative AI)
- **QEF**: Quantum Emotional Field (network-based emotion sync)
- **Ethics**: Resonant Ethics protocols

## Development Guidelines

### When Editing C++ Code

- Check for JUCE dependencies
- Ensure CMake compatibility
- Maintain plugin processor/editor separation
- Test with standalone build before DAW integration

### When Editing Python Code

- Check which requirements.txt applies (`ml_framework/` vs `python/`)
- Maintain compatibility with Python 3.8+
- Use type hints for clarity
- Reference implementations in `reference/` for guidance

### When Working with Data Files

- Validate JSON structure
- Check for existing emotion mappings before adding new ones
- Maintain consistency with emotion thesaurus structure
- Update related documentation if schema changes

### When Adding Features

- Consider both C++ (real-time) and Python (ML) implementations
- Document in appropriate `MARKDOWN/` file
- Update relevant README files
- Add tests when possible

## Common Patterns

### Emotion Mapping

```python
# Standard emotion structure
{
  "valence": -1.0 to 1.0,
  "arousal": 0.0 to 1.0,
  "intensity": 0.0 to 1.0
}
```

### Music Generation

- Use engines in `src/engines/` for C++
- Use `reference/python_kelly/engines/` for Python reference
- Follow rule-breaking system for emotional expression

### Data Loading

- Use `DataLoader` in C++ (`src/common/DataLoader.h`)
- Check `data/` directory structure
- Handle missing files gracefully

## File Naming Conventions

- **C++**: PascalCase for classes, camelCase for functions (`EmotionThesaurus.h`, `processIntent()`)
- **Python**: snake_case for files and functions (`emotion_thesaurus.py`, `process_intent()`)
- **Data**: lowercase with underscores (`emotions/anger.json`, `chord_progressions_db.json`)

## Testing

- C++ tests: `tests/` directory, use Catch2
- Python tests: Add to respective module directories
- Test emotion mappings against thesaurus
- Test rule-breaking system with various intensities

## Documentation

- Main docs: `MARKDOWN/` directory
- ML Framework: `ml_framework/README.md`, `ml_framework/FRAMEWORK_SUMMARY.md`
- Phase 2: `phase2/KELLY_PHASE2_IMPLEMENTATION_GUIDE.md`
- Update relevant docs when making significant changes

## Important Notes

- **Multiple Implementations**: There are multiple Python implementations (`reference/`, `python/`, `CODE/PYTHON CODE/`). Understand which one you're working with.
- **Data Paths**: Data files may be referenced from different locations. Check path resolution in code.
- **Build System**: CMake handles JUCE dependency automatically. Don't manually manage JUCE.
- **Version**: Current development version is v3.0.00+. Check version in relevant files.

## When in Doubt

1. Check `MARKDOWN/` for project status and integration notes
2. Look at `reference/` for working implementations
3. Review `data/` structure for data file formats
4. Check existing code patterns before adding new features
5. Maintain the philosophy: "Interrogate Before Generate"
